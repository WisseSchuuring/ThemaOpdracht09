---
title: "Exploratory Data Analysis"
author: "Wisse Schuuring"
date: "9/27/2021"
output:
  pdf_document: default
  word_document: default
---

## Introduction
This EDA explores the "Crab body metrics" dataset in order to utilize it for data mining and machine learning experiments. The main question being, is it possible to create an algorithm which, when given measurements of the body of a purple rock crab, determine whether or not it belongs to the blue or orange species? This EDA shall explore, edit and, if needed, manipulate the data that shall be utilized in researching this question.


## Data origin

"Crab body metrics" is the title of the dataset sourced from "A Multivariate Study of Variation in Two Species of Rock Crab of the Genus Leptograpsus", an article published in 1974 by N. A. Campbell and R. J. Mahon.

## Data 

This dataset contains 200 rows and 8 columns, describing 5 morphological measurements on 200 crabs, 50 male and 50 female for both species respectively. Each crab of two colour forms and both sexes, of the species Leptograpsus variegatus. These crabs were collected at Fremantle, West Australia.

```{r, message=FALSE, echo=FALSE}

library(ggplot2)
library(dplyr)
library(xtable)
library(ggbiplot)
library(gridExtra)
library(cowplot)

CrabData <- read.csv(file = 'data/CrabData.csv')

CrabData <- CrabData %>% mutate(
  sp = factor(sp, levels = c("B","O"), 
  labels = c("Blue Leptograspus","Orange Leptograspus")))
CrabData <- CrabData %>% mutate(
  sex = factor(sex)
  )

codebook <- read.csv(file = "data/codebook.csv")
knitr::kable(codebook) 
```


The crabs have been measured on their frontal lobe size (FL), rear width (RW), carapace length (CL), carapace width (CW) and body depth (BD) in mm. Furthermore their gender and colour have been recorded. 

Out of the 200 rows, 0 of them contain missing values. The data is complete, containing no missing values, as stated in the article.^[1]

## Visualisation


There is an even distribution of records from both species of Leptograspus, with 50% Blue and 50% orange.

```{r, echo=FALSE}
FLRW <- ggplot(CrabData, aes(x=FL, y=RW, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))
FLCL <- ggplot(CrabData, aes(x=FL, y=CL, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))
FLCW <- ggplot(CrabData, aes(x=FL, y=CW, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))
FLBD <- ggplot(CrabData, aes(x=FL, y=BD, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))

RWCL <- ggplot(CrabData, aes(x=RW, y=CL, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))
RWCW <- ggplot(CrabData, aes(x=RW, y=CW, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))
RWBD <- ggplot(CrabData, aes(x=RW, y=BD, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))

CLCW <- ggplot(CrabData, aes(x=CL, y=CW, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))
CLBD <- ggplot(CrabData, aes(x=CL, y=BD, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))

CWBD <- ggplot(CrabData, aes(x=CW, y=BD, col=sp)) + geom_point() +  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange"))

plot_grid(FLRW, FLCL, FLCW, FLBD, RWCL)
plot_grid(RWCW, RWBD, CLCW, CLBD, CWBD)
```

```{r, fig.width=6.5,fig.height=3, fig.cap="A dotplot showing the different carapace width and frontal lobe size between the blue and orange purple rock crab species.", echo=FALSE}

#Create a plot comparing the CW to the FL in order to determine the species
ggplot(CrabData, aes(y = CW, x = FL, color=sp)) +
  geom_point() +
  scale_x_continuous() +
  geom_jitter() +
  scale_color_manual(values=c("Blue","Orange")) +
  xlab("Frontal Lobe Size (mm)") +
  ylab("Carapace Width (mm)") +
  ggtitle("Carapace Width vs Frontal Lobe Size of the Purple Rock Crab")+
  labs(col="Species of Crab")
```

The most prominent separation between the blue and orange species can be visualized when discriminating upon the carapace width (CW) and the frontal lobe size (FL). These are the optimal variables with which one could classify the species of Leptograpsus.

```{r, fig.width=6,fig.height=3, fig.cap="A dotplot showing the different carapace width and frontal lobe size between the female and male purple rock crab.", echo=FALSE}
# 
# #Create a plot comparing the RW to the CL to determine the gender of the crab
# ggplot(CrabData, aes(y = RW, x = CL, color=sex)) +
#   geom_point() +
#   scale_x_continuous() +
#   geom_jitter() +
#   scale_color_manual(values=c("Pink","Light Blue"), labels=c("Female","Male")) +
#   xlab("Carapace Length (mm)") +
#   ylab("Rear Width (mm)") +
#   ggtitle("Carapace Length vs Rear Width of the Purple Rock Crab")+
#   labs(col="Gender of Crab")
``` 

Discriminating upon carapace length (CL) and rear width (RW) shows the gender difference and can be used to identify individuals of either crab species' gender.

```{r, fig.width=6.5,fig.height=3, fig.cap="A dotplot showing the different carapace width and body depth between the blue and orange purple rock crab species.", echo=FALSE}
# 
# #Create a plot comparing the CW to the BD to determine the species of the crab
# ggplot(CrabData, aes(y = CW, x = BD, color=sp)) +
#   geom_point() +
#   scale_x_continuous() +
#   geom_jitter() +
#   scale_color_manual(values=c("Blue","Orange")) +
#   xlab("Body Depth (mm)") +
#   ylab("Carapace Width (mm)") +
#   ggtitle("Carapace Width vs Body Depth of the Purple Rock Crab")+
#   labs(col="Species of Crab")
```

Although discriminating upon carapace width (CW) and body depth (BD) too can be used to determine the species of the Purple rock crab, it is less reliant and separate than discriminating on carapace width (CW) and the frontal lobe size (FL).

```{r, fig.width=6.5,fig.height=3, fig.cap= "PCA showing how the rear width has a higher factor than any of the other values recorded within the dataset.", echo=FALSE}

#Create a PCA of the Crabdata and visualise it in a ggbiplot
CrabData.pca <- prcomp(CrabData[4:8], center = TRUE, scale. = TRUE)
ggbiplot(CrabData.pca,
         main="Principal component analysis of the Crab body metrics")
```

As seen in the PCA, all variables have about equal weight to the direction of the data, with the exception of Rear Width, which makes the RW value the one with the most information gain.

```{r, echo=FALSE}
#clean up the data by removing unused data
CleanData <- CrabData[c(4,7,8,1)]
str(CleanData)
```

By removing unneeded and unused data, the dataset will be cleaner and more readily usable for the algorithm that will utilize it.

## Results

Opening and reading the dataset 'Crab Body Metrics' shows it containing the values frontal lobe size (FL), rear width (RW), carapace length (CL), carapace width (CW) and body depth (BD) in mm, as well as the crabs' gender and species. The dataset contained numeric values that were changed to doubles. Visualising the dataset and plotting out the values suggested in the article by N.A. Campbell and R.J. Mahon ^[2] against one another, the first being Carapace Width against Frontal Lobe Size, discriminated by species. Secondly Carapace Length against Rear Width, discriminated by gender. Lastly Carapace Width against Body Depth, again discriminated by species. Comparing the first and last, in order to determine which values to use for the algorithm, one concludes that the first is the most suitable, for the distance between the two lines drawn is most distinct when setting the frontal lobe size against the carapace width. However, Body Depth will remain in the dataset for it can be used for more accurate classification. This data can be used for machine learning purposes and creating the algorithm that when fed the proper measurements, can determine whether the given crab's data belongs to an individual belonging to the Blue Leptograspus or one belonging to the Orange Leptograspus. 

```{r, echo=FALSE}
# Create a plot using the cleaned up data
ggplot(data = CleanData,  
mapping = aes( 
x = FL,  
y = CW,  
color = sp)) + 
   geom_jitter(alpha = 0.5) +  
   geom_smooth(method = "lm", se = FALSE, formula="y~x") +
   scale_color_manual(values=c("Blue","Orange")) +
   labs( 
x = "Frontal Lobe Size (mm)",  
y = "Carapace Width (mm)",  
colour = "Crab Species",
title = "Carapace Width vs Frontal Lobe Size of the Purple Rock Crab")
```

## Discussion

The Data set itself is free of missing values, and contains all but two numeric values. furthermore the data itself contains no duplicated values nor any corrupted data. the downside is that there are merely 200 sampled organisms. While the distribution is perfect, being 50/50 on both species and gender, a bigger population would have been desirable for the machine learning.

## Conclusion

By removing all unnecessary records, the data set itself has been optimally data mined and prepared for the machine learning process. However, the data set could have been ameliorated by obtaining more examples of the frontal lobe and carapce width of the purple rock crab, or by more precise measurements containing decimals. 

## References

[1] N.A. Campbell and R.J. Mahon (1974),'A Multivariate Study of Variation in Two Species of Rock Crab of the Genus Leptograpsus', Awt. J. Zool (p.418).
[2] N.A. Campbell and R.J. Mahon (1974),'A Multivariate Study of Variation in Two Species of Rock Crab of the Genus Leptograpsus', Awt. J. Zool (p.424).

## Classification method comparison

```{r, echo=FALSE}
write.csv(CleanData, file = "data/CleanData.csv", row.names = FALSE)
```

Speed is not a priority for this algorithm, however Scalability is. The algorithm should be capable of accurately identifying a large amount of measurements at once. Therefore, batch is more suitable than streaming processing, as measurements should be taken in bulk, and then fed to the algorithm. there will not be researchers fishing up crabs every single second, nor will the crabs radically change in size.   

Using this newly created CleanData.csv file in Weka 3.8, by first removing the identifier attribute by selecting it and pressing 'remove', one can move over to the classify window. There, first running a ZeroR with the 'training set' test option selected will reveal the accuracy of the algorithm to be 50%. this makes sense, as there is an even distribution of both blue and orange purple rock crabs in the dataset. with ZeroR, the algorithm will only look at a single attribute and take it as truth. Simply put, the system will assume every identified attribute shall be the one that is most prominent. This dataset containing 100 blue and 100 orange purple rock crabs, it picks one, and assumes all others are the same as the one it picked. Therefore, a 50% accuracy is expected, as 100/200 * 100 = 50%.

In order to determine the best classification method for the 'Crab Body Metrics', The following methods were used on the data set with test option 'cross-validation', having a fold value of 10. Speed, accuracy, True positives, False positives, True negatives and False negatives were all recorded within a csv file. The results of which are shown below.

```{r, fig.cap="A table showing the speed and accuracy of the classification method, along with the confusion matrix", echo=FALSE}
WekaResults <- read.csv(file = "data/WekaResults.csv")
knitr::kable(WekaResults) 
```

Upon further testing utilizing a CostSensitiveClassifier, it is clear that the Simple Logistic classification method is the most suitable to identify the crab species and thus for creating the algorithm. 

Using the Weka experimenter, the algorithms were run for 100 repetitions each, with a total of 8000 results. 

```{r, fig.cap="A table showing the overall accuracy of the classification method along with the significant after 100 runs of each individual method.", echo=FALSE}
ExperimentResults <- read.csv(file = "data/ExperimentResults.csv")
knitr::kable(ExperimentResults) 
```
 As expected, SimpleLogistic has the highest accuracy rating, along with the smallest significant (excluding ZeroR). 